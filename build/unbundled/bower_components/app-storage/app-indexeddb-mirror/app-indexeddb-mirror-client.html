<html><head><link rel="import" href="common-worker.html"><script>(function(){'use strict';var a='__workerUrl',b='__connectsToWorker',c='__connected',d='__messageId',e='__mirroringSupported';Polymer.AppIndexedDBMirrorClient=function(h){this[a]=h,this[c]=!1,this[d]=0,this[b]=null,this[e]=null,this.connect()},Polymer.AppIndexedDBMirrorClient.prototype={get supportsMirroring(){return this[e]},validateSession:function(g){return void 0===g?void 0:this.post({type:'app-mirror-validate-session',session:g})},post:function(g){return this.connect().then(function(h){return this[e]?new Promise(function(i){var j=this[d]++,k=h.port;k.addEventListener('message',function l(m){m.data&&m.data.id===j&&(k.removeEventListener('message',l),i(m.data.result))}),g.id=j,k.postMessage(g)}.bind(this)):Promise.resolve({})}.bind(this))},transaction:function(g,h,i){return this.post({type:'app-mirror-transaction',method:g,key:h,value:i})},closeDb:function(){return this.post({type:'app-mirror-close-db'})},connect:function(){return this[c]||this[b]?this[b]:(console.log('App IndexedDB Client connecting..'),this[b]=new Promise(function(g){var h=new Polymer.CommonWorker(this[a]);h.port.addEventListener('message',function(i){i.data&&'app-mirror-connected'===i.data.type&&(console.log('App IndexedDB Client connected!'),this[c]=!0,this[e]=i.data.supportsIndexedDB,g(h))}.bind(this)),h.addEventListener('error',function(i){console.error(i.message||i)}),h.port.start(),h.port.postMessage({type:'app-mirror-connect'})}.bind(this)))}}})();</script><link rel="prefetch" href="common-worker.html"></head><body></body></html>