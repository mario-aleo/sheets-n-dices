<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">

<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">

<link rel="import" href="../../bower_components/paper-card/paper-card.html">

<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">

<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">

<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../snd-chip/snd-chip.html">


<dom-module id="snd-new">
    <template>
        <style>
            :host {
                display: block;
                height: 100%;
                width: 100%;
                --paper-tabs-selection-bar-color: var(--secondary-color);
                --paper-fab-background: var(--secondary-color);
                --paper-fab-keyboard-focus-background: var(--focus-color);
            }
            paper-tabs {
                background-color: var(--primary-color);
                color: #FFF;
            }
            paper-card {
                margin-top: 16px;
                width: 100%;
            }
            paper-checkbox {
                margin-top: 16px;
                margin-right: 8px;
            }
            paper-button {
                margin-top: 16px;
                margin: auto;
            }
            paper-fab {
                position: fixed;
                bottom: 16px;
                right: 16px;
                box-shadow: var(--paper-material-elevation-4_-_box-shadow);
            }
            paper-input,
            paper-dropdown-menu {
                width: 100%;
            }
            .paper-card-row {
                display: flex;
                flex-direction: row;
                align-items: center;
            }
            .primary-paper-button {
                background-color: var(--primary-color);
                color: #FFF;
            }
            .secondary-paper-button {
                color: var(--secondary-color);
            }
            .red-paper-button {
                color: #FF5252
            }
            .add-button-container {
                display: flex;
                flex-direction: row;
                align-items: center;
                width: 100%;
                padding: 16px 0;
            }
            .dependency-section {
                padding: 12px 0 8px 0;
            }
            .dependency-overlay:after {
                content:"&nbsp;";
                display: block;
                position: fixed;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: 102;
                background-color: rgba(0,0,0,0.7)
            }
            @media (min-width: 426px) {
                .basic-page {
                    width: calc(100% - 16px);
                    height: calc(100% - 16px);
                    padding: 8px;
                }
                .basic-card {
                    width: 50%;
                    margin: 8px 25%;
                }
                .status-page {
                    display: flex;
                    flex-direction: row;
                    flex-wrap: wrap;
                    align-content: flex-start;
                    width: calc(100% - 16px);
                    height: calc(100% - 16px);
                    padding: 8px;
                }
                .status-card {
                    width: calc(50% - 16px);
                    margin: 8px;
                }
            }
            @media (min-width: 769px) {
                .status-card {
                    width: calc((100% / 3) - 16px);
                }
                .basic-card {
                    width: calc(100% / 3);
                    margin: 8px calc(100% / 3);
                }
            }
        </style>

        <paper-tabs
            scrollable
            hide-scroll-buttons
            fit-container
            selected="{{ tabSelected }}">
            <paper-tab>
                Basic
            </paper-tab>
            <paper-tab>
                Status
            </paper-tab>
            <paper-tab>
                Resources
            </paper-tab>
            <paper-tab>
                Defenses
            </paper-tab>
            <paper-tab>
                Skills
            </paper-tab>
        </paper-tabs>

        <iron-pages id="ironPages"
            selected="{{ tabSelected }}">
            <!-- Basic Tab -->
            <section class="basic-page">
                <paper-card class="basic-card"
                    elevation="2">
                    <div class="card-content">
                        <paper-input
                            always-float-label
                            type="text"
                            label="Name"
                            value="{{ newSheet.name }}">
                        </paper-input>
                        <paper-input
                            always-float-label
                            type="text"
                            label="Class"
                            value="{{ newSheet.job }}">
                        </paper-input>
                        <paper-input
                            always-float-label
                            type="text"
                            label="Race"
                            value="{{ newSheet.race }}">
                        </paper-input>
                        <paper-input
                            always-float-label
                            type="number"
                            label="Level"
                            value="{{ newSheet.level }}">
                        </paper-input>
                        <paper-input
                            always-float-label
                            type="text"
                            label="System"
                            value="{{ newSheet.system }}">
                        </paper-input>
                        <div class="paper-card-row">
                            <paper-checkbox
                                checked="{{ newSheet.hasMinimumStatusModifierValue }}">
                            </paper-checkbox>
                            <paper-input
                                always-float-label
                                type="number"
                                label="Minimum Status Value Modifier"
                                value="{{ newSheet.minimumStatusModifierValue }}"
                                disabled="{{ !newSheet.hasMinimumStatusModifierValue }}">
                            </paper-input>
                        </div>
                    </div>
                </paper-card>
            </section>
            <!-- Status Tab -->
            <section class="status-page">
                <template
                    is="dom-repeat"
                    items="[[ newSheet.statusList ]]"
                    as="status"
                    index-as="statusIndex">
                    <paper-card class="status-card"
                        elevation="2">
                        <div class="card-content">
                            <paper-input
                                always-float-label
                                type="text"
                                label="Name"
                                value="{{ status.name }}">
                            </paper-input>
                            <paper-input
                                always-float-label
                                type="number"
                                label="Base Value"
                                value="{{ status.baseValue }}">
                            </paper-input>
                            <paper-input
                                always-float-label
                                type="number"
                                label="Level Modifier"
                                value="{{ status.levelModifier }}">
                            </paper-input>
                            <section class="dependency-section">
                                <template
                                    is="dom-repeat"
                                    items="[[ status.dependencyList ]]"
                                    as="dependency"
                                    index-as="dependencyIndex">
                                    <snd-chip
                                        on-click="_editStatusDependency"
                                        data-status-index$="[[ statusIndex ]]"
                                        data-status-location="statusList"
                                        data-dependency-index$="[[ dependencyIndex ]]">
                                        [[ _dependencyChipName(dependency.name, dependency.location) ]]
                                    </snd-chip>
                                </template>
                            </section>
                            <paper-button class="secondary-paper-button"
                                on-tap="_addStatusDependency"
                                data-status-index$="[[ statusIndex ]]"
                                data-status-location="statusList">
                                Add Dependency
                            </paper-button>
                        </div>
                        <div class="card-actions">
                            <paper-button class="red-paper-button"
                                on-tap="_deleteStatus"
                                data-status-index$="[[ statusIndex ]]"
                                data-status-location="statusList">
                                Delete Status
                            </paper-button>
                        </div>
                    </paper-card>
                </template>
                <div class="add-button-container">
                    <paper-button class="primary-paper-button"
                        raised
                        on-tap="_addStatus"
                        data-status-location="statusList">
                        Add Status
                    </paper-button>
                </div>
            </section>
            <!-- Resources Tab -->
            <section class="status-page">
                <template
                    is="dom-repeat"
                    items="[[ newSheet.resourcesList ]]"
                    as="resouces"
                    index-as="resourcesIndex">
                    <paper-card class="status-card"
                        elevation="2">
                        <div class="card-content">
                            <paper-input
                                always-float-label
                                type="text"
                                label="Name"
                                value="{{ resouces.name }}">
                            </paper-input>
                            <paper-input
                                always-float-label
                                type="number"
                                label="Base Value"
                                value="{{ resouces.baseValue }}">
                            </paper-input>
                            <paper-input
                                always-float-label
                                type="number"
                                label="Level Modifier"
                                value="{{ resouces.levelModifier }}">
                            </paper-input>
                            <section class="dependency-section">
                                <template
                                    is="dom-repeat"
                                    items="[[ resouces.dependencyList ]]"
                                    as="dependency"
                                    index-as="dependencyIndex">
                                    <snd-chip
                                        on-click="_editStatusDependency"
                                        data-status-index$="[[ resourcesIndex ]]"
                                        data-status-location="resourcesList"
                                        data-dependency-index$="[[ dependencyIndex ]]">
                                        [[ _dependencyChipName(dependency.name, dependency.location) ]]
                                    </snd-chip>
                                </template>
                            </section>
                            <paper-button class="secondary-paper-button"
                                on-tap="_addStatusDependency"
                                data-status-index$="[[ resourcesIndex ]]"
                                data-status-location="resourcesList">
                                Add Dependency
                            </paper-button>
                        </div>
                        <div class="card-actions">
                            <paper-button class="red-paper-button"
                                on-tap="_deleteStatus"
                                data-status-index$="[[ resourcesIndex ]]"
                                data-status-location="resourcesList">
                                Delete Resoruce
                            </paper-button>
                        </div>
                    </paper-card>
                </template>
                <div class="add-button-container">
                    <paper-button class="primary-paper-button"
                        raised
                        on-tap="_addStatus"
                        data-status-location="resourcesList">
                        Add Resource
                    </paper-button>
                </div>
            </section>
            <!-- Defenses Tab -->
            <section class="status-page">
                <template
                    is="dom-repeat"
                    items="[[ newSheet.defensesList ]]"
                    as="defenses"
                    index-as="defensesIndex">
                    <paper-card class="status-card"
                        elevation="2">
                        <div class="card-content">
                            <paper-input
                                always-float-label
                                type="text"
                                label="Name"
                                value="{{ defenses.name }}">
                            </paper-input>
                            <paper-input
                                always-float-label
                                type="number"
                                label="Base Value"
                                value="{{ defenses.baseValue }}">
                            </paper-input>
                            <paper-input
                                always-float-label
                                type="number"
                                label="Level Modifier"
                                value="{{ defenses.levelModifier }}">
                            </paper-input>
                            <section class="dependency-section">
                                <template
                                    is="dom-repeat"
                                    items="[[ defenses.dependencyList ]]"
                                    as="dependency"
                                    index-as="dependencyIndex">
                                    <snd-chip
                                        on-click="_editStatusDependency"
                                        data-status-index$="[[ defensesIndex ]]"
                                        data-status-location="defensesList"
                                        data-dependency-index$="[[ dependencyIndex ]]">
                                        [[ _dependencyChipName(dependency.name, dependency.location) ]]
                                    </snd-chip>
                                </template>
                            </section>
                            <paper-button class="secondary-paper-button"
                                on-tap="_addStatusDependency"
                                data-status-index$="[[ defensesIndex ]]"
                                data-status-location="defensesList">
                                Add Dependency
                            </paper-button>
                        </div>
                        <div class="card-actions">
                            <paper-button class="red-paper-button"
                                on-tap="_deleteStatus"
                                data-status-index$="[[ defensesIndex ]]"
                                data-status-location="defensesList">
                                Delete Defense
                            </paper-button>
                        </div>
                    </paper-card>
                </template>
                <div class="add-button-container">
                    <paper-button class="primary-paper-button"
                        raised
                        on-tap="_addStatus"
                        data-status-location="defensesList">
                        Add Defense
                    </paper-button>
                </div>
            </section>
            <!-- Skills Tab -->
            <section
                class="status-page">
                <template
                    is="dom-repeat"
                    items="[[ newSheet.skillsList ]]"
                    as="skills"
                    index-as="skillsIndex">
                    <paper-card class="status-card"
                        elevation="2">
                        <div class="card-content">
                            <paper-input
                                always-float-label
                                type="text"
                                label="Name"
                                value="{{ skills.name }}">
                            </paper-input>
                            <paper-input
                                always-float-label
                                type="number"
                                label="Base Value"
                                value="{{ skills.baseValue }}">
                            </paper-input>
                            <paper-input
                                always-float-label
                                type="number"
                                label="Level Modifier"
                                value="{{ skills.levelModifier }}">
                            </paper-input>
                            <section class="dependency-section">
                                <template
                                    is="dom-repeat"
                                    items="[[ skills.dependencyList ]]"
                                    as="dependency"
                                    index-as="dependencyIndex">
                                    <snd-chip
                                        on-click="_editStatusDependency"
                                        data-status-index$="[[ skillsIndex ]]"
                                        data-status-location="skillsList"
                                        data-dependency-index$="[[ dependencyIndex ]]">
                                        [[ _dependencyChipName(dependency.name, dependency.location) ]]
                                    </snd-chip>
                                </template>
                            </section>
                            <paper-button class="secondary-paper-button"
                                on-tap="_addStatusDependency"
                                data-status-index$="[[ skillsIndex ]]"
                                data-status-location="skillsList">
                                Add Dependency
                            </paper-button>
                        </div>
                        <div class="card-actions">
                            <paper-button class="red-paper-button"
                                on-tap="_deleteStatus"
                                data-status-index$="[[ skillsIndex ]]"
                                data-status-location="skillsList">
                                Delete Skill
                            </paper-button>
                        </div>
                    </paper-card>
                </template>
                <div class="add-button-container">
                    <paper-button class="primary-paper-button"
                        raised
                        on-tap="_addStatus"
                        data-status-location="skillsList">
                        Add Skill
                    </paper-button>
                </div>
            </section>
        </iron-pages>

        <!-- Save Fab Button -->
        <paper-fab
            icon="save"
            elevation="4"
            on-tap="_newSheet">
        </paper-fab>

        <!-- Dependency Dialog -->
        <paper-dialog id="dependencyDialog"
            opened="{{ dependencyDialogOpened }}">
            <div>
                <paper-dropdown-menu
                    label="Location">
                    <paper-listbox class="dropdown-content"
                        slot="dropdown-content"
                        attr-for-selected="location"
                        selected="{{ dependencyLocation }}">
                        <paper-item
                            location="statusList">
                            Status
                        </paper-item>
                        <paper-item
                            location="resourcesList">
                            Resources
                        </paper-item>
                        <paper-item
                            location="defensesList">
                            Defenses
                        </paper-item>
                        <paper-item
                            location="skillsList">
                            Skills
                        </paper-item>
                    </paper-listbox>
                </paper-dropdown-menu>
                <paper-dropdown-menu
                    label="Dependency">
                    <paper-listbox id="dependencyList"
                        class="dropdown-content"
                        slot="dropdown-content"
                        attr-for-selected="name"
                        selected="{{ dependencyName }}">
                        <template id="dependencyListOptions"
                            is="dom-repeat"
                            items="[[ newSheet.statusList ]]"
                            as="attr"
                            mutable-data>
                            <paper-item 
                                name="[[ attr.name ]]">
                                [[ attr.name ]]
                            </paper-item>
                        </template>
                    </paper-listbox>
                </paper-dropdown-menu>
                <paper-input id="dependencyDialogValue"
                    always-float-label
                    type="number"
                    label="Value"
                    value="{{ dependencyValue }}">
                </paper-input>
            </div>
            <div class="buttons">
                <paper-button id="dependencyDialogCancel"
                    class="red-paper-button"
                    on-tap="_cancel">
                    Cancel
                </paper-button>
                <paper-button id="dependencyDialogConfirm"
                    class="secondary-paper-button"
                    on-tap="_confirm"
                    autofocus>
                    Confirm
                </paper-button>
            </div>
        </paper-dialog>

        <!-- Toast -->
        <paper-toast id="sndNewToast"
            duration="2000">
        </paper-toast>
    </template>

    <script>
        class SndNew extends Polymer.Element {
            static get is() { return 'snd-new'; }

            static get properties() {
                return {
                    tabSelected: {
                        type: Number,
                        value: 0
                    },
                    newSheet: {
                        type: Object,
                        value: new Sheet(),
                        notify: true
                    },
                    dependencyChain: {
                        type: Array
                    },

                    requestStatusDependencyLocation: {
                        type: String
                    },
                    requestStatusDependencyName: {
                        type: String
                    },

                    dependencyDialogOpened: {
                        type: Boolean,
                        value: false
                    },
                    dependencyLocation: {
                        type: String,
                        value: "statusList"
                    },
                    dependencyName: {
                        type: String
                    },
                    dependencyValue: {
                        type: Number
                    }
                };
            }

            static get observers() {
                return [
                    '_dependencyDialogOpenedChanged(dependencyDialogOpened)',
                    '_dependencyLocationChanged(dependencyLocation)',
                    '_dependencyNameChanged(dependencyName)',
                    '_dependencyValueChanged(dependencyValue)'
                ];
            }

            /*
             *  Observers
             */
            _dependencyDialogOpenedChanged(dependencyDialogOpened) {
                if (dependencyDialogOpened) this.$.ironPages.classList.add("dependency-overlay");
                else this.$.ironPages.classList.remove("dependency-overlay");
                this.$.dependencyListOptions.render();
                return;
            }

            _dependencyLocationChanged(dependencyLocation) {
                this.$.dependencyListOptions.items = this.newSheet[dependencyLocation];
                this.$.dependencyListOptions.render();
                this.set('dependencyName', '');
                this._dependencyValueDisabled();
                return;
            }

            _dependencyNameChanged() {
                this._dependencyAddDisabled();
                this._dependencyValueDisabled();
                return;
            }

            _dependencyValueChanged() {
                this._dependencyAddDisabled();
                this._dependencyValueDisabled();
                return;
            }
            /*
             */

            /*
             *  Calculate Value Functions
             */
            _dependencyChipName(dependencyName, dependencyLocation) {
                let dependencyChip = dependencyName;
                if (dependencyLocation == 'statusList') dependencyChip = dependencyChip + " on Status";
                else if (dependencyLocation == 'resourcesList') dependencyChip = dependencyChip + " on Resources";
                else if (dependencyLocation == 'defensesList') dependencyChip = dependencyChip + " on Defenses";
                else dependencyChip = dependencyChip + " on Skills";
                return dependencyChip;
            }

            _dependencyValueDisabled() {
                if (this.dependencyLocation == 'statusList' && this.newSheet.hasMinimumStatusModifierValue) {
                    this.$.dependencyDialogValue.disabled = true;
                } else {
                    this.$.dependencyDialogValue.disabled = false;
                };
                return;
            }

            _dependencyAddDisabled() {
                if (this.dependencyLocation == this.requestStatusDependencyLocation && this.dependencyName == this.requestStatusDependencyName) {
                    this.$.dependencyDialogConfirm.disabled = true;
                } else if (!this.dependencyName) {
                    this.$.dependencyDialogConfirm.disabled = true;
                } else if (!this.dependencyValue && !this.newSheet.hasMinimumStatusModifierValue) {
                    this.$.dependencyDialogConfirm.disabled = true;
                } else {
                    this.$.dependencyDialogConfirm.disabled = false;
                }
                return;
            }
            /*
             */

            /*
             *  Generic Functions
             */
            _addStatus(event) {
                let path = 'newSheet.' + event.target.dataset.statusLocation;
                this.push(path, new Status());
                return;
            }

            _deleteStatus(event) {
                let index = event.target.dataset.statusIndex,
                    path = 'newSheet.' + event.target.dataset.statusLocation;
                this.splice(path, index, 1);
                return;
            }

            _addStatusDependency(event) {
                let index = event.target.dataset.statusIndex,
                    location = event.target.dataset.statusLocation,
                    path = 'newSheet.' + location + '.' + index + '.dependencyList',
                    element = this;
                this.set('dependencyLocation', 'statusList');
                this.set('dependencyName', '');
                this.set('dependencyValue', 0);
                this.set('requestStatusDependencyLocation', location);
                this.set('requestStatusDependencyName', this.newSheet.statusList[index].name);
                this._dependencyValueDisabled();
                this._dependencyAddDisabled();
                this._cancel = tapEvent => {
                    element.set('dependencyLocation', 'statusList');
                    element.set('dependencyName', '');
                    element.set('dependencyValue', 0);
                    element.$.dependencyDialog.close();
                }
                this._confirm = tapEvent => {
                    element.push(path, new Dependency(element.dependencyLocation, element.dependencyName, element.dependencyValue));
                    element.set('dependencyLocation', 'statusList');
                    element.set('dependencyName', '');
                    element.set('dependencyValue', 0);
                    element.$.dependencyDialog.close();
                }
                this.$.dependencyDialog.open();
                return;
            }

            _editStatusDependency(event) {
                let statusIndex = event.target.dataset.statusIndex,
                    statusLocation = event.target.dataset.statusLocation,
                    dependencyIndex = event.target.dataset.dependencyIndex,
                    depencencyStatus = this.newSheet[statusLocation][statusIndex].dependencyList[dependencyIndex],
                    path = 'newSheet.' + statusLocation + '.' + statusIndex + '.dependencyList.' + dependencyIndex,
                    element = this;
                this.set('dependencyLocation', depencencyStatus.location);
                this.set('dependencyName', depencencyStatus.name);
                this.set('dependencyValue', depencencyStatus.modifier);
                this.set('requestStatusDependencyLocation', statusLocation);
                this.set('requestStatusDependencyName', this.newSheet.statusList[statusIndex].name);
                this._cancel = tapEvent => {
                    element.set('dependencyLocation', statusLocation);
                    element.set('dependencyName', '');
                    element.set('dependencyValue', 0);
                    element.$.dependencyDialog.close();
                }
                this._confirm = tapEvent => {
                    element.set(path, new Dependency(element.dependencyLocation, element.dependencyName, element.dependencyValue));
                    element.$.dependencyDialog.close();
                }
                this.$.dependencyDialog.open();
                return;
            }
            /*
             */

            /*
             *  Sheet Object Functions
             */
            _newSheet(event) {
                if (!this.newSheet.name
                    || !this.newSheet.job
                    || !this.newSheet.race
                    || !this.newSheet.level
                    || !this.newSheet.system) {
                    this.$.sndNewToast.text = "Please, fill the Basic tab.";
                    this.$.sndNewToast.opened = true;
                    return;
                }
                // Each Status, Resource, Defense and Skill and SUM
                const element = this;
                this.set("dependencyChain", []);
                parseInt(element._numberTypeCheck(element.newSheet.level));
                // SUM Status = baseValue + (levelModifier * level)
                this.newSheet.statusList.forEach(function (status) {
                    if (status.value === 0) {
                        element.push("dependencyChain", {
                            location: "statusList",
                            status: status
                        });
                        element._objectCalculation(status);
                        element.dependencyChain = [];
                    }
                });
                // SUM Resource = baseValue + (statusBase.value * statusBaseModifier) + (levelModifier * level)
                // or if statusBase == None => SUM Resource = baseValue + (levelModifier * level)
                this.newSheet.resourcesList.forEach(function (resource) {
                    if (resource.value === 0) {
                        element.push("dependencyChain", {
                            location: "resourcesList",
                            status: resource
                        });
                        element._objectCalculation(resource);
                        element.dependencyChain = [];
                    }
                });
                // SUM Defense = baseValue + (statusBase.value * statusBaseModifier) + (levelModifier * level)
                // or if statusBase == None => SUM Defense = baseValue + (levelModifier * level)
                this.newSheet.defensesList.forEach(function (defense) {
                    if (defense.value === 0) {
                        element.push("dependencyChain", {
                            location: "defensesList",
                            status: defense
                        });
                        element._objectCalculation(defense);
                        element.dependencyChain = [];
                    }
                });
                // SUM Skill = baseValue + (statusBase.value * statusBaseModifier) + (levelModifier * level)
                // or if statusBase == None => SUM Skill = baseValue + (levelModifier * level)
                this.newSheet.skillsList.forEach(function (skill) {
                    if (skill.value === 0) {
                        element.push("dependencyChain", {
                            location: "skillsList",
                            status: skill
                        });
                        element._objectCalculation(skill);
                        element.dependencyChain = [];
                    }
                });
                console.log(this.newSheet);
                this.dispatchEvent(new CustomEvent('addNewSheet', {detail: {sheetData: element.newSheet}, composed: true}));
                this.set("tabSelected", 0);
                this.set("newSheet", new Sheet());
                return;
            }

            _objectCalculation(statusItem) {
                // Encapsulation
                const element = this;
                // Init statusItem Value
                statusItem.value = parseInt(parseInt(element._numberTypeCheck(statusItem.baseValue)) + parseInt(element._numberTypeCheck(element.newSheet.level)) * parseFloat(element._numberTypeCheck(statusItem.levelModifier)));
                console.log("Initial " + statusItem.name + " Value: " + statusItem.value);
                // Verify statusItem Dependency
                if (statusItem.dependencyList.length > 0) {
                    // Start statusItem Value Calculation
                    element.dependencyChain.forEach(function (dependencyChainItem) {
                        statusItem.dependencyList.forEach(function (statusItemDependencyItem) {
                            // Verify Deadlock
                            if (statusItemDependencyItem.location == dependencyChainItem.location && statusItemDependencyItem.name == dependencyChainItem.status.name) {
                                element.$.sndNewToast.text = "Please, very all dependencies.";
                                element.$.sndNewToast.opened = true;
                                throw "Deadlock";
                            } else {
                                // Localize Dependency Object
                                element.newSheet[statusItemDependencyItem.location].forEach(function (statusItemDependencyItemStatusItem) {
                                    if (statusItemDependencyItemStatusItem.name == statusItemDependencyItem.name) {
                                        // Verify Dependency Object
                                        if (statusItemDependencyItemStatusItem.value === 0) {
                                            // Calculate Dependency Object
                                            element.push("dependencyChain", {
                                                location: statusItemDependencyItem.location,
                                                status: statusItemDependencyItemStatusItem
                                            });
                                            element._objectCalculation(statusItemDependencyItemStatusItem);
                                        }
                                        // Update statusItem Value
                                        if (statusItemDependencyItem.location == "statusList") {
                                            if (element.newSheet.hasMinimumStatusModifierValue) statusItem.value = parseInt( parseInt(element._numberTypeCheck(statusItem.value)) + element._returnStatusModifier(parseInt(element._numberTypeCheck(statusItemDependencyItemStatusItem.value)), parseFloat(element.newSheet.minimumStatusModifierValue)));
                                            else statusItem.value = parseInt( parseInt(element._numberTypeCheck(statusItem.value)) + parseInt(element._numberTypeCheck(statusItemDependencyItemStatusItem.value)) * parseFloat(element._numberTypeCheck(statusItemDependencyItem.modifier)) );
                                        } else {
                                            statusItem.value = parseInt( parseInt(element._numberTypeCheck(statusItem.value)) + parseInt(element._numberTypeCheck(statusItemDependencyItemStatusItem.value)) * parseFloat(element._numberTypeCheck(statusItemDependencyItem.modifier)) );
                                        }
                                        console.log("Update " + statusItem.name + " Value with " + statusItemDependencyItemStatusItem.name +  " Value: " + statusItem.value);
                                    }
                                });
                            }
                        });
                    });
                }
                // End statusItem Value Calculation
                console.log("End " + statusItem.name + " Value Calculation: " + statusItem.value);
                return;
            }

            _numberTypeCheck(number) {
                number = number.toString().replace(',', '.');
                if (isNaN(parseInt(number))) return "0";
                else return number;
            }

            _returnStatusModifier(statusValue, minimumStatusModifierValue) {
                let element = this;
                if (parseInt(element._numberTypeCheck(statusValue)) >= parseInt(element._numberTypeCheck(minimumStatusModifierValue))) {
                    return parseInt((parseInt(element._numberTypeCheck(statusValue)) - parseInt(element._numberTypeCheck(minimumStatusModifierValue))) / 2);
                } 
                else {
                    return parseInt((parseInt(element._numberTypeCheck(statusValue)) - parseInt(element._numberTypeCheck(minimumStatusModifierValue))) / 2 - 0.5);
                }
            }
            /*
             */
        }

        /*
         *  Sheet Object Definitions
         */
        class Sheet {
            constructor() {
                this.name = "";
                this.job = "";
                this.race = "";
                this.level = 1;
                this.system = "";
                this.hasMinimumStatusModifierValue = false;
                this.minimumStatusModifierValue = 10;
                this.statusList = [ new Status("Vitality") ];
                this.resourcesList = [ new Status("HP") ];
                this.defensesList = [ new Status("Armor") ];
                this.skillsList = [ new Status("Diplomacy") ];
                this.persistBonusList = [];
                this.volatileBonusList = [];
                this.notesList = [];
                this.itemsList = [];
            }
        };
        
        class Status {
            constructor(name) {
                this.name = name;
                this.value = 0;
                this.baseValue = 0;
                this.levelModifier = 0;
                this.persistBonus = 0;
                this.volatileBonus = 0;
                this.dependencyList = [ ];
            }
        };

        class Dependency {
            constructor(location, name, value) {
                this.location = location;
                this.name = name;
                this.modifier = value;
            }
        };
        /*
         */

        window.customElements.define(SndNew.is, SndNew);
    </script>
</dom-module>

